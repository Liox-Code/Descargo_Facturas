CREATE TABLE USUARIOS (
    CI VARCHAR(30) PRIMARY KEY NOT NULL,
    NOMBRE VARCHAR(30) NOT NULL,
    APELLIDO VARCHAR(30) NOT NULL,
    NOMBRE_USUARIO VARCHAR(30) NOT NULL UNIQUE,
    CLAVE VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(50) NOT NULL UNIQUE,
    TIPO VARCHAR(20) NOT NULL
);

CREATE TABLE FECHA_LIMITE_RH(
    COD_LIM INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    CIRH VARCHAR(30) NOT NULL,
    SUCURSAL VARCHAR(30) NOT NULL,
    FECHA_LIMITE_RH  DATE NOT NULL,
    FOREIGN KEY (CIRH) REFERENCES USUARIOS(CI)
);

CREATE TABLE FECHA_LIMITE_USU(
    COD_FECH_USU INT PRIMARY KEY AUTO_INCREMENT,
    CI VARCHAR(30) NOT NULL,
    COD_LIM INT NOT NULL,
    ENTREGADO BIT NOT NULL,
    SUELDO INT NOT NULL,
    CREDITO INT,
    TIPO_TRABAJO varchar(20),
    FOREIGN KEY (CI) REFERENCES USUARIOS(CI),
    FOREIGN KEY (COD_LIM) REFERENCES FECHA_LIMITE_RH(COD_LIM)
);

CREATE TABLE ENVIOS(
    COD_FECH_USU INT PRIMARY KEY AUTO_INCREMENT,
	CI VARCHAR(30) NOT NULL,
    IMPUESTO INT NOT NULL,
    IMPORTE INT NOT NULL,
    CREDITO INT NOT NULL,
    DEUDA INT NOT NULL,
    CREDITO_ACUMULADO INT NOT NULL,
    SUELDO INT NOT NULL,
    FECHA_ENTREGADO DATE NOT NULL,
    FECHA_LIMITE_RH  DATE NOT NULL,
    FOREIGN KEY (CI) REFERENCES USUARIOS(CI)
);

CREATE TABLE FACTURAS(
	  NUM_FACTURA VARCHAR(30) NOT NULL,
    CI VARCHAR(30) NOT NULL,
    NIT VARCHAR(30) NOT NULL,
    NUM_AUTORISACION VARCHAR(30) NOT NULL,
    FECHA DATE NOT NULL,
    FECHA_VENCIMIENTO DATE NOT NULL,
    IMPORTE INT NOT NULL,
    ENTREGADO BIT NOT NULL,
    VALIDO BIT NOT NULL,
    COD_CONTROL VARCHAR(30),
    COD_FECH_USU INT NOT NULL,
    PRIMARY KEY (NUM_FACTURA,NUM_AUTORISACION,NIT),
    FOREIGN KEY (CI) REFERENCES USUARIOS (CI),
    FOREIGN KEY (COD_FECH_USU) REFERENCES FECHA_LIMITE_USU (COD_FECH_USU)
);

CREATE TABLE ENTREGADA(
    CI VARCHAR(30) NOT NULL,
    NUM_FACTURA VARCHAR(30) NOT NULL,
    NUM_AUTORISACION VARCHAR(30) NOT NULL,
    NIT VARCHAR(30) NOT NULL,
    FECHA_ENTREGADA DATE NOT NULL,
    FECHA_LIMITE_RH DATE NOT NULL,
    FOREIGN KEY (CI) REFERENCES USUARIOS(CI),
    FOREIGN KEY (NUM_FACTURA,NUM_AUTORISACION,NIT) REFERENCES FACTURAS(NUM_FACTURA,NUM_AUTORISACION,NIT)
);

create table IngresoSistema (
    fecha date
)

SELECT U.NOMBRE,FRH.COD_LIM,FUSU.ENTREGADO,FUSU.COD_FECH_USU,U2.NOMBRE,U2.EMAIL
FROM USUARIOS U
INNER JOIN fecha_limite_rh FRH ON FRH.CIRH = U.CI
INNER JOIN fecha_limite_usu FUSU ON FUSU.COD_LIM = FRH.COD_LIM
INNER JOIN USUARIOS U2 ON U2.CI=FUSU.CI

SELECT e.FECHA_LIMITE_RH
FROM entregada e
INNER JOIN facturas f on f.NUM_FACTURA=e.NUM_FACTURA and f.NIT=e.NIT and f.NUM_AUTORISACION = e.NUM_AUTORISACION
GROUP BY e.FECHA_LIMITE_RH

-- phpMyAdmin SQL Dump
-- version 4.8.3
-- https://www.phpmyadmin.net/
--
-- Servidor: 127.0.0.1:3306
-- Tiempo de generación: 21-11-2018 a las 03:59:37
-- Versión del servidor: 5.7.23
-- Versión de PHP: 7.2.10

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET AUTOCOMMIT = 0;
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Base de datos: `id7922399_descargofacturas2`
--

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `entregada`
--

DROP TABLE IF EXISTS `entregada`;
CREATE TABLE IF NOT EXISTS `entregada` (
  `CI` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NUM_FACTURA` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NUM_AUTORISACION` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NIT` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `FECHA_ENTREGADA` date NOT NULL,
  `FECHA_LIMITE_RH` date NOT NULL,
  KEY `CI` (`CI`),
  KEY `NUM_FACTURA` (`NUM_FACTURA`),
  KEY `NUM_AUTORISACION` (`NUM_AUTORISACION`),
  KEY `NIT` (`NIT`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `envios`
--

DROP TABLE IF EXISTS `ENVIOS`;
CREATE TABLE IF NOT EXISTS `ENVIOS` (
  `COD_ENVIOS` int(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,
  `COD_FECH_USU` int(11) NOT NULL,
  `CI` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `IMPUESTO` int(11) NOT NULL,
  `IMPORTE` int(11) NOT NULL,
  `CREDITO` int(11) NOT NULL,
  `DEUDA` int(11) NOT NULL,
  `CREDITO_ACUMULADO` int(11) NOT NULL,
  `SUELDO` int(11) NOT NULL,
  `FECHA_ENTREGADO` date NOT NULL,
  `FECHA_LIMITE_RH` date NOT NULL,
  KEY `CI` (`CI`),
  KEY `COD_FECH_USU` (`COD_FECH_USU`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `facturas`
--

DROP TABLE IF EXISTS `facturas`;
CREATE TABLE IF NOT EXISTS `facturas` (
  `NUM_FACTURA` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `CI` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NIT` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NUM_AUTORISACION` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `FECHA` date NOT NULL,
  `FECHA_VENCIMIENTO` date NOT NULL,
  `IMPORTE` int(11) NOT NULL,
  `ENTREGADO` bit(1) NOT NULL,
  `VALIDO` bit(1) NOT NULL,
  `COD_CONTROL` varchar(30) COLLATE utf8_unicode_ci DEFAULT NULL,
  `COD_FECH_USU` int(11) NOT NULL,
  PRIMARY KEY (`NUM_FACTURA`,`NUM_AUTORISACION`,`NIT`),
  KEY `CI` (`CI`),
  KEY `COD_FECH_USU` (`COD_FECH_USU`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `fecha_limite_rh`
--

DROP TABLE IF EXISTS `fecha_limite_rh`;
CREATE TABLE IF NOT EXISTS `fecha_limite_rh` (
  `COD_LIM` int(11) NOT NULL AUTO_INCREMENT,
  `CIRH` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `SUCURSAL` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `FECHA_LIMITE_RH` date NOT NULL,
  PRIMARY KEY (`COD_LIM`),
  KEY `CIRH` (`CIRH`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `fecha_limite_usu`
--

DROP TABLE IF EXISTS `fecha_limite_usu`;
CREATE TABLE IF NOT EXISTS `fecha_limite_usu` (
  `COD_FECH_USU` int(11) NOT NULL AUTO_INCREMENT,
  `CI` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `COD_LIM` int(11) NOT NULL,
  `ENTREGADO` bit(1) NOT NULL,
  `SUELDO` int(11) NOT NULL,
  `CREDITO` int(11) DEFAULT NULL,
  `TIPO_TRABAJO` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,
  PRIMARY KEY (`COD_FECH_USU`),
  KEY `CI` (`CI`),
  KEY `COD_LIM` (`COD_LIM`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `usuarios`
--

DROP TABLE IF EXISTS `usuarios`;
CREATE TABLE IF NOT EXISTS `usuarios` (
  `CI` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NOMBRE` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `APELLIDO` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `NOMBRE_USUARIO` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `CLAVE` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `EMAIL` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `TIPO` varchar(20) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`CI`),
  UNIQUE KEY `NOMBRE_USUARIO` (`NOMBRE_USUARIO`),
  UNIQUE KEY `CLAVE` (`CLAVE`),
  UNIQUE KEY `EMAIL` (`EMAIL`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;

